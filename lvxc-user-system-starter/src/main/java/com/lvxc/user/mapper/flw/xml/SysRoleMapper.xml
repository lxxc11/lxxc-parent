<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lvxc.user.mapper.flw.SysRoleMapper">

    <select id="getRoleByUserId" resultType="com.lvxc.user.entity.SysRole">
        SELECT
            sr.*
        FROM
            "sys_role" sr
        JOIN "sys_user_role" sur ON sr."id" = sur.role_id
        WHERE
            sr.del_flag = FALSE
          AND sur.user_id = #{userId}
    </select>

    <select id="getPageList" resultType="com.lvxc.user.entity.SysRole">
        SELECT
        DISTINCT sr.*
        FROM
            "sys_role" sr
                left JOIN "sys_role_platform" srp on sr."id" = srp.role_id
        <where>
            <if test="dto.keyWord != null and dto.keyWord !=''">
               ( sr.role_name LIKE concat('%', #{dto.keyWord}::text, '%')
                or sr.description LIKE concat('%', #{dto.keyWord}::text, '%') )
            </if>
            <if test="dto.platformIds != null and dto.platformIds.size() > 0">
                AND srp.platform_id IN
                <foreach collection="dto.platformIds" item="item" separator="," close=")" open="(" index="index">
                    #{item}
                </foreach>
            </if>
        </where>
        order by sr.update_time desc
    </select>

</mapper>